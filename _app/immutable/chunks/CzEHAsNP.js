import{a as h,I as u,s as g}from"./DwuaTuXd.js";import{l as K,g as Q}from"./CaognTaA.js";import{w as b,H as C,f as p}from"./BN8yeNaP.js";import{c as f,a as m}from"./CPzlj7tX.js";import"./B0gZMrfj.js";import{l as _,s as $}from"./DzUgQEOZ.js";const x=b("disconnected"),k=b(0),Y=b(null);let l=null,T=null,N=null,A=null;const q="asd";function X(t,e){if(!(N===t&&l?.readyState===WebSocket.OPEN)){Z(),N=t,A=e||null,x.set("connecting");try{l=new WebSocket(q),l.onopen=()=>{console.log("ðŸ”— Realtime: connected"),x.set("connected"),l?.send(JSON.stringify({action:"join",room_code:t,peer_id:et(),is_host:!1,metadata:null}))},l.onmessage=a=>{try{const n=JSON.parse(a.data);tt(n)}catch{}},l.onclose=()=>{console.log("ðŸ”Œ Realtime: disconnected"),x.set("disconnected"),k.set(0),N&&(T=setTimeout(()=>{N&&X(N,A||void 0)},3e3))},l.onerror=()=>{console.warn("âš ï¸ Realtime: connection error")}}catch(a){console.warn("âš ï¸ Realtime: failed to connect",a),x.set("disconnected")}}}function Z(){N=null,A=null,T&&(clearTimeout(T),T=null),l&&(l.onclose=null,l.close(),l=null),x.set("disconnected"),k.set(0)}function S(t,e,a,n){if(!l||l.readyState!==WebSocket.OPEN)return;const r={action:"broadcast",data:JSON.stringify({entity:t,action:e,id:a||void 0,data:n,timestamp:Date.now()})};l.send(JSON.stringify(r))}function tt(t){switch(t.type){case"room_info":Array.isArray(t.peers)&&k.set(t.peers.length);break;case"peer_joined":k.set(C(k)+1);break;case"peer_left":const e=C(k);e>0&&k.set(e-1);break;case"data":try{const a=JSON.parse(t.data);console.log(`ðŸ“¡ Realtime: ${a.entity} ${a.action}${a.id?` (${a.id})`:""}`),Y.set({entity:a.entity,action:a.action,id:a.id,data:a.data,timestamp:a.timestamp||Date.now()}),A&&A(a)}catch(a){console.warn("Realtime: Failed to parse data payload",a)}break}}function et(){return"peer_"+Math.random().toString(36).substring(2,8)+"_"+Date.now().toString(36)}let R=!1;async function ft(){R||(K(),R=!0,console.log("âœ… DB layer initialised (API mode)"))}function y(){return Q()}function L(t){return t._id?.$oid?t._id.$oid:typeof t._id=="string"?t._id:""}function J(t){return{id:L(t),title:t.title||"",project:t.project||"",duration_minutes:t.duration_minutes||0,date:t.date||"",end_date:t.end_date||void 0,status:t.status||"todo",category:t.category||"à¸­à¸·à¹ˆà¸™à¹†",notes:t.notes||"",assignee_ids:t.assignee_ids||[],assignees:[],assignee_id:null,assignee:null,sprint_id:t.sprint_id||null,is_archived:t.is_archived||!1,checklist:t.checklist||void 0,created_at:t.created_at||"",updated_at:t.updated_at||""}}function W(t){return{id:L(t),name:t.name||"",repo_url:t.repo_url||void 0,created_at:t.created_at||""}}function V(t){return{id:L(t),name:t.name||"",color:t.color||"#6366F1",discord_id:t.discord_id||void 0,user_id:t.user_id||void 0,created_at:t.created_at||""}}async function mt(t){const e=await h.data.tasks.create(y(),{title:t.title,project:t.project||"",duration_minutes:t.duration_minutes,date:t.date,end_date:t.end_date||null,status:t.status,category:t.category||"à¸­à¸·à¹ˆà¸™à¹†",notes:t.notes||"",assignee_ids:t.assignee_ids?.map(String)||null,sprint_id:t.sprint_id?String(t.sprint_id):null,is_archived:t.is_archived||!1,checklist:t.checklist||null}),a=await e.json();if(!e.ok)throw new Error(a.error||"Failed to create task");const n=J(a.task);return S("task","create",n.id,n),n.id}async function at(t,e){const a={};e.title!==void 0&&(a.title=e.title),e.project!==void 0&&(a.project=e.project),e.duration_minutes!==void 0&&(a.duration_minutes=e.duration_minutes),e.date!==void 0&&(a.date=e.date),e.end_date!==void 0&&(a.end_date=e.end_date||null),e.status!==void 0&&(a.status=e.status),e.category!==void 0&&(a.category=e.category),e.notes!==void 0&&(a.notes=e.notes),e.assignee_ids!==void 0&&(a.assignee_ids=e.assignee_ids?.map(String)||null),e.sprint_id!==void 0&&(a.sprint_id=e.sprint_id?String(e.sprint_id):null),e.is_archived!==void 0&&(a.is_archived=e.is_archived),e.checklist!==void 0&&(a.checklist=e.checklist||null);const n=await h.data.tasks.update(y(),String(t),a),i=await n.json();if(!n.ok)throw new Error(i.error||"Failed to update task");S("task","update",String(t),a)}async function _t(t){const e=await h.data.tasks.delete(y(),String(t));if(!e.ok){const a=await e.json();throw new Error(a.error||"Failed to delete task")}S("task","delete",String(t))}async function M(t){const e={};if(t?.status&&t.status!=="all")if(t.status==="today"){const r=new Date().toISOString().split("T")[0];e.start_date=r,e.end_date=r,e.status="active"}else t.status==="active"?e.status="active":t.status==="archived"?e.status="archived":e.status=t.status;t?.category&&t.category!=="all"&&(e.category=t.category),t?.project&&t.project!=="all"&&(e.project=t.project),t?.assignee_id&&t.assignee_id!=="all"&&t.assignee_id!==null&&(e.assignee_id=String(t.assignee_id)),t?.sprint_id&&t.sprint_id!=="all"&&t.sprint_id!==null&&(e.sprint_id=String(t.sprint_id)),t?.search&&(e.search=t.search),t?.startDate&&(e.start_date=t.startDate),t?.endDate&&(e.end_date=t.endDate),t?.includeArchived&&(e.include_archived="true");const a=await h.data.tasks.list(y(),e),n=await a.json();if(!a.ok)throw new Error(n.error||"Failed to fetch tasks");const i=(n.tasks||[]).map(J);try{const r=await G(),o=new Map(r.map(s=>[String(s.id),s]));for(const s of i)s.assignee_ids&&s.assignee_ids.length>0&&(s.assignees=s.assignee_ids.map(c=>o.get(String(c))).filter(Boolean),s.assignee=s.assignees[0]||null,s.assignee_id=s.assignees[0]?.id??null)}catch{}return i}async function nt(t){return M({sprint_id:t,includeArchived:!0})}async function $t(t){const e=await nt(t);let a=0;for(const n of e)!n.is_archived&&n.id&&(await at(n.id,{is_archived:!0}),a++);return a}async function ht(){return(await U()).map(e=>e.name)}async function U(){const t=await h.data.projects.list(y()),e=await t.json();if(!t.ok)throw new Error(e.error||"Failed to fetch projects");return(e.projects||[]).map(W)}async function yt(){const t=await U(),e=await M({includeArchived:!0});return t.map(a=>({id:String(a.id),taskCount:e.filter(n=>n.project===a.name).length}))}async function vt(t){const e=await h.data.projects.create(y(),{name:t.name,repo_url:t.repo_url||null}),a=await e.json();if(!e.ok)throw new Error(a.error||"Failed to create project");const n=W(a.project);S("project","create",n.id,n)}async function wt(t,e){const a={};e.name!==void 0&&(a.name=e.name),e.repo_url!==void 0&&(a.repo_url=e.repo_url||null);const n=await h.data.projects.update(y(),String(t),a),i=await n.json();if(!n.ok)throw new Error(i.error||"Failed to update project");S("project","update",String(t),a)}async function St(t){const e=await h.data.projects.delete(y(),String(t));if(!e.ok){const a=await e.json();throw new Error(a.error||"Failed to delete project")}S("project","delete",String(t))}async function G(){const t=await h.data.assignees.list(y()),e=await t.json();if(!t.ok)throw new Error(e.error||"Failed to fetch assignees");return(e.assignees||[]).map(V)}async function kt(){const t=await G(),e=await M({includeArchived:!0});return t.map(a=>({id:String(a.id),taskCount:e.filter(n=>n.assignee_ids?.map(String).includes(String(a.id))).length}))}async function jt(t){const e=await h.data.assignees.create(y(),{name:t.name,color:t.color||"#6366F1",discord_id:t.discord_id||null,user_id:t.user_id||null}),a=await e.json();if(!e.ok)throw new Error(a.error||"Failed to create assignee");const n=V(a.assignee);S("assignee","create",n.id,n)}async function Nt(t,e){const a={};e.name!==void 0&&(a.name=e.name),e.color!==void 0&&(a.color=e.color),e.discord_id!==void 0&&(a.discord_id=e.discord_id||null),e.user_id!==void 0&&(a.user_id=e.user_id||null);const n=await h.data.assignees.update(y(),String(t),a),i=await n.json();if(!n.ok)throw new Error(i.error||"Failed to update assignee");S("assignee","update",String(t),a)}async function bt(t){const e=await h.data.assignees.delete(y(),String(t));if(!e.ok){const a=await e.json();throw new Error(a.error||"Failed to delete assignee")}S("assignee","delete",String(t))}async function xt(){const t=await M({includeArchived:!0}),e=new Set(t.map(a=>a.category).filter(Boolean));return Array.from(e).sort()}async function At(){const t=await M({includeArchived:!0}),e=t.length,a=t.filter(s=>s.status==="todo").length,n=t.filter(s=>s.status==="in-progress").length,i=t.filter(s=>s.status==="in-test").length,r=t.filter(s=>s.status==="done").length,o=t.reduce((s,c)=>s+(c.duration_minutes||0),0);return{total:e,todo:a,in_progress:n,in_test:i,done:r,total_minutes:o}}async function Mt(t,e){return console.warn("importAllData: Not yet implemented in API mode"),{tasks:0,projects:0,assignees:0,sprints:0}}async function Pt(t){return console.warn("exportFilteredSQLiteBinary: Not available in API mode"),new Uint8Array}function Ft(t,e){const a=_(e,["children","$$slots","$$events","$$legacy"]);const n=[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z"}]];u(t,$({name:"bookmark"},()=>a,{get iconNode(){return n},children:(i,r)=>{var o=f(),s=p(o);g(s,e,"default",{}),m(i,o)},$$slots:{default:!0}}))}function Tt(t,e){const a=_(e,["children","$$slots","$$events","$$legacy"]);const n=[["circle",{cx:"12",cy:"12",r:"10"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16"}]];u(t,$({name:"circle-alert"},()=>a,{get iconNode(){return n},children:(i,r)=>{var o=f(),s=p(o);g(s,e,"default",{}),m(i,o)},$$slots:{default:!0}}))}function Dt(t,e){const a=_(e,["children","$$slots","$$events","$$legacy"]);const n=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"}]];u(t,$({name:"copy"},()=>a,{get iconNode(){return n},children:(i,r)=>{var o=f(),s=p(o);g(s,e,"default",{}),m(i,o)},$$slots:{default:!0}}))}function Et(t,e){const a=_(e,["children","$$slots","$$events","$$legacy"]);const n=[["path",{d:"M12 15V3"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["path",{d:"m7 10 5 5 5-5"}]];u(t,$({name:"download"},()=>a,{get iconNode(){return n},children:(i,r)=>{var o=f(),s=p(o);g(s,e,"default",{}),m(i,o)},$$slots:{default:!0}}))}function zt(t,e){const a=_(e,["children","$$slots","$$events","$$legacy"]);const n=[["path",{d:"M15 3h6v6"}],["path",{d:"M10 14 21 3"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}]];u(t,$({name:"external-link"},()=>a,{get iconNode(){return n},children:(i,r)=>{var o=f(),s=p(o);g(s,e,"default",{}),m(i,o)},$$slots:{default:!0}}))}function It(t,e){const a=_(e,["children","$$slots","$$events","$$legacy"]);const n=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5"}],["path",{d:"M10 9H8"}],["path",{d:"M16 13H8"}],["path",{d:"M16 17H8"}]];u(t,$({name:"file-text"},()=>a,{get iconNode(){return n},children:(i,r)=>{var o=f(),s=p(o);g(s,e,"default",{}),m(i,o)},$$slots:{default:!0}}))}function Ct(t,e){const a=_(e,["children","$$slots","$$events","$$legacy"]);const n=[["circle",{cx:"9",cy:"12",r:"1"}],["circle",{cx:"9",cy:"5",r:"1"}],["circle",{cx:"9",cy:"19",r:"1"}],["circle",{cx:"15",cy:"12",r:"1"}],["circle",{cx:"15",cy:"5",r:"1"}],["circle",{cx:"15",cy:"19",r:"1"}]];u(t,$({name:"grip-vertical"},()=>a,{get iconNode(){return n},children:(i,r)=>{var o=f(),s=p(o);g(s,e,"default",{}),m(i,o)},$$slots:{default:!0}}))}function Lt(t,e){const a=_(e,["children","$$slots","$$events","$$legacy"]);const n=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"}]];u(t,$({name:"play"},()=>a,{get iconNode(){return n},children:(i,r)=>{var o=f(),s=p(o);g(s,e,"default",{}),m(i,o)},$$slots:{default:!0}}))}function Ot(t,e){const a=_(e,["children","$$slots","$$events","$$legacy"]);const n=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];u(t,$({name:"rotate-ccw"},()=>a,{get iconNode(){return n},children:(i,r)=>{var o=f(),s=p(o);g(s,e,"default",{}),m(i,o)},$$slots:{default:!0}}))}function Rt(t,e){const a=_(e,["children","$$slots","$$events","$$legacy"]);const n=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7"}]];u(t,$({name:"save"},()=>a,{get iconNode(){return n},children:(i,r)=>{var o=f(),s=p(o);g(s,e,"default",{}),m(i,o)},$$slots:{default:!0}}))}function Bt(t,e){const a=_(e,["children","$$slots","$$events","$$legacy"]);const n=[["path",{d:"M14 17H5"}],["path",{d:"M19 7h-9"}],["circle",{cx:"17",cy:"17",r:"3"}],["circle",{cx:"7",cy:"7",r:"3"}]];u(t,$({name:"settings-2"},()=>a,{get iconNode(){return n},children:(i,r)=>{var o=f(),s=p(o);g(s,e,"default",{}),m(i,o)},$$slots:{default:!0}}))}function Ht(t,e){const a=_(e,["children","$$slots","$$events","$$legacy"]);const n=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915"}],["circle",{cx:"12",cy:"12",r:"3"}]];u(t,$({name:"settings"},()=>a,{get iconNode(){return n},children:(i,r)=>{var o=f(),s=p(o);g(s,e,"default",{}),m(i,o)},$$slots:{default:!0}}))}function Jt(t,e){const a=_(e,["children","$$slots","$$events","$$legacy"]);const n=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];u(t,$({name:"triangle-alert"},()=>a,{get iconNode(){return n},children:(i,r)=>{var o=f(),s=p(o);g(s,e,"default",{}),m(i,o)},$$slots:{default:!0}}))}const I="khu-phaen-theme";function st(){const e=(typeof window<"u"?localStorage.getItem(I):null)||"system",{subscribe:a,set:n,update:i}=b(e);function r(o){if(typeof window>"u")return;const s=document.documentElement,c=window.matchMedia("(prefers-color-scheme: dark)").matches,d=o==="dark"||o==="system"&&c;console.log("applyTheme:",{theme:o,systemPrefersDark:c,isDark:d,rootClasses:s.classList.toString()}),d?s.classList.add("dark"):(s.classList.remove("dark"),document.body.classList.remove("dark"),s.className=s.className.replace(/\bdark\b/g,"").trim(),document.body.className=document.body.className.replace(/\bdark\b/g,"").trim(),console.log("After removal - root:",s.classList.toString(),"body:",document.body.classList.toString())),localStorage.setItem(I,o)}return typeof window<"u"&&(r(e),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>{(localStorage.getItem(I)||"system")==="system"&&r("system")})),{subscribe:a,set:o=>{n(o),r(o)},update:i,toggle:()=>{const o=C(ot),s=typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").matches,d=o==="dark"||o==="system"&&s?"light":"dark";n(d),r(d)}}}const ot=st(),Wt=b(!1),B="khu-phaen-time-logs-v1";function rt(){const t=()=>{if(typeof window>"u")return[];try{const r=localStorage.getItem(B);if(r){const o=JSON.parse(r);if(Array.isArray(o))return o.slice(-50)}}catch(r){console.error("Failed to load time logs:",r)}return[]},{subscribe:e,set:a,update:n}=b(t()),i=r=>{typeof window<"u"&&localStorage.setItem(B,JSON.stringify(r.slice(-50)))};return{subscribe:e,add:(r,o="")=>{n(s=>{const c={id:crypto.randomUUID(),duration:r,note:o.trim(),createdAt:Date.now()},d=[...s,c];return i(d),d})},remove:r=>{n(o=>{const s=o.filter(c=>c.id!==r);return i(s),s})},clear:()=>{a([]),i([])},getTotalToday:()=>{const r=new Date().setHours(0,0,0,0);return t().filter(s=>s.createdAt>=r).reduce((s,c)=>s+c.duration,0)}}}const Vt=rt();function Ut(t){const e=Math.floor(t/3600),a=Math.floor(t%3600/60),n=t%60;return e>0?`${e}:${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`:`${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}const it=t=>t;function O(t){const e=t-1;return e*e*e+1}function H(t){const e=typeof t=="string"&&t.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[t,"px"]}function Gt(t,{delay:e=0,duration:a=400,easing:n=it}={}){const i=+getComputedStyle(t).opacity;return{delay:e,duration:a,easing:n,css:r=>`opacity: ${r*i}`}}function Kt(t,{delay:e=0,duration:a=400,easing:n=O,x:i=0,y:r=0,opacity:o=0}={}){const s=getComputedStyle(t),c=+s.opacity,d=s.transform==="none"?"":s.transform,w=c*(1-o),[P,j]=H(i),[D,E]=H(r);return{delay:e,duration:a,easing:n,css:(F,z)=>`
			transform: ${d} translate(${(1-F)*P}${j}, ${(1-F)*D}${E});
			opacity: ${c-w*z}`}}function Qt(t,{delay:e=0,duration:a=400,easing:n=O,axis:i="y"}={}){const r=getComputedStyle(t),o=+r.opacity,s=i==="y"?"height":"width",c=parseFloat(r[s]),d=i==="y"?["top","bottom"]:["left","right"],w=d.map(v=>`${v[0].toUpperCase()}${v.slice(1)}`),P=parseFloat(r[`padding${w[0]}`]),j=parseFloat(r[`padding${w[1]}`]),D=parseFloat(r[`margin${w[0]}`]),E=parseFloat(r[`margin${w[1]}`]),F=parseFloat(r[`border${w[0]}Width`]),z=parseFloat(r[`border${w[1]}Width`]);return{delay:e,duration:a,easing:n,css:v=>`overflow: hidden;opacity: ${Math.min(v*20,1)*o};${s}: ${v*c}px;padding-${d[0]}: ${v*P}px;padding-${d[1]}: ${v*j}px;margin-${d[0]}: ${v*D}px;margin-${d[1]}: ${v*E}px;border-${d[0]}-width: ${v*F}px;border-${d[1]}-width: ${v*z}px;min-${s}: 0`}}function Yt(t,{delay:e=0,duration:a=400,easing:n=O,start:i=0,opacity:r=0}={}){const o=getComputedStyle(t),s=+o.opacity,c=o.transform==="none"?"":o.transform,d=1-i,w=s*(1-r);return{delay:e,duration:a,easing:n,css:(P,j)=>`
			transform: ${c} scale(${1-d*j});
			opacity: ${s-w*j}
		`}}export{jt as A,Ft as B,Tt as C,Et as D,zt as E,It as F,Ct as G,mt as H,nt as I,k as J,_t as K,bt as L,Nt as M,$t as N,St as O,Lt as P,wt as Q,Ot as R,Bt as S,Jt as T,vt as U,Rt as a,Ut as b,Qt as c,Dt as d,ot as e,Gt as f,Ht as g,M as h,ft as i,Yt as j,Kt as k,X as l,Z as m,At as n,xt as o,ht as p,U as q,yt as r,Wt as s,Vt as t,G as u,kt as v,at as w,Mt as x,Pt as y,x as z};
