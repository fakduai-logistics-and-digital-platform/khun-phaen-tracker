import{w as c}from"./BN8yeNaP.js";import{a as m}from"./DwuaTuXd.js";const t=c(null),a=c(!0);function _(r){const o=`; ${document.cookie}`.split(`; ${r}=`);return o.length===2?o.pop()?.split(";").shift():null}async function p(){a.set(!0);try{if(_("_khun_ph_token")){const s=localStorage.getItem("user_email"),o=localStorage.getItem("user_id"),i=localStorage.getItem("user_profile"),d=localStorage.getItem("user_uuid"),u=localStorage.getItem("user_role"),n=localStorage.getItem("user_discord_id");s&&o&&t.set({id:o,email:s,user_id:d||"",role:u||"user",discord_id:n||void 0,profile:i?JSON.parse(i):void 0});const l=await m.auth.me();if(l.ok){const e=await l.json();t.set({id:e.id,email:e.email,user_id:e.user_id,role:e.role||"user",discord_id:e.discord_id,profile:e.profile}),localStorage.setItem("user_email",e.email),localStorage.setItem("user_id",e.id),localStorage.setItem("user_uuid",e.user_id),localStorage.setItem("user_role",e.role||"user"),e.discord_id?localStorage.setItem("user_discord_id",e.discord_id):localStorage.removeItem("user_discord_id"),e.profile&&localStorage.setItem("user_profile",JSON.stringify(e.profile))}else document.cookie="_khun_ph_token=; path=/; max-age=0; samesite=Lax",localStorage.removeItem("user_email"),localStorage.removeItem("user_id"),t.set(null)}else t.set(null)}catch(r){console.error("Auth init failed:",r),t.set(null)}finally{a.set(!1)}}export{a,p as i,t as u};
